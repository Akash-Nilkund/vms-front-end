# Solution for Visitor Registration Error

## Problem Diagnosis
The error **"Content-Type 'application/json' is not supported"** (HTTP 415 or 500) occurs because there is a mismatch between the Frontend request and the Backend expectation.

1.  **Frontend (`VisitorCheckInForm.jsx`):**
    - Correctly constructs a `FormData` object.
    - Appends `visitorJsonData` as a `Blob` with `type: 'application/json'`.
    - Appends `photo` as a file.
    - This results in a `multipart/form-data` request.

2.  **Backend (`VisitorController.java`):**
    - The error indicates the backend is likely configured to expect `application/json` directly (e.g., `@RequestBody Visitor visitor`), or it has `consumes = MediaType.APPLICATION_JSON_VALUE`.
    - It rejects the `multipart/form-data` request because it doesn't know how to handle the multipart boundary and parts when expecting a raw JSON body.

## Backend Solution (VisitorController.java)

You need to update your `registerVisitor` method in `VisitorController.java` to explicitly handle `multipart/form-data`.

**Replace your existing `registerVisitor` method with this:**

```java
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import com.fasterxml.jackson.databind.ObjectMapper;

// ... inside VisitorController class

    @PostMapping(value = "/register", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
    public ResponseEntity<Visitor> registerVisitor(
            @RequestPart("visitorJsonData") String visitorJsonData,
            @RequestPart(value = "photo", required = false) MultipartFile photo) {
        
        try {
            // 1. Manually deserialize the JSON string to your Visitor object
            ObjectMapper objectMapper = new ObjectMapper();
            Visitor visitor = objectMapper.readValue(visitorJsonData, Visitor.class);

            // 2. Call your service with both the visitor object and the photo
            Visitor savedVisitor = visitorService.registerVisitor(visitor, photo);
            
            return ResponseEntity.ok(savedVisitor);
            
        } catch (Exception e) {
            e.printStackTrace();
            return ResponseEntity.status(500).build();
        }
    }
```

### Key Changes:
1.  **`consumes = MediaType.MULTIPART_FORM_DATA_VALUE`**: Explicitly tells Spring to accept multipart requests.
2.  **`@RequestPart("visitorJsonData") String visitorJsonData`**: Receives the JSON part as a String first. This is often more robust than letting Spring try to convert it automatically, which can sometimes fail with complex content-type headers within parts.
3.  **`ObjectMapper`**: Manually converts the JSON string to the `Visitor` object.
4.  **`@RequestPart("photo")`**: Correctly handles the file upload.

---

## Frontend Review (VisitorCheckInForm.jsx)

I checked the frontend code and it looks **correct** for sending this request.
- It uses `FormData`.
- It appends `visitorJsonData` correctly:
  ```javascript
  const jsonBlob = new Blob([JSON.stringify(visitorPayload)], { type: 'application/json' });
  submissionData.append('visitorJsonData', jsonBlob);
  ```
- It appends `photo` correctly.

### Regarding "Unnecessary Callbacks"

1.  **`useEffect` Dependency**:
    - In `VisitorCheckInForm.jsx`, the `useEffect` hook has an empty dependency array `[]`.
    - It calls `visitorService.getAllCompanies()` and `getAllHosts()`.
    - Since `visitorService` is an imported module (not a component prop or state), it is stable and **does not** need to be in the dependency array.
    - **Verdict:** The `useEffect` is correct and efficient. It runs once on mount.

2.  **Blocking Alerts**:
    - The code uses `alert('Registration successful!...')`.
    - `alert()` blocks the browser UI thread until the user clicks OK.
    - **Recommendation:** While not a "callback" error, it's better to use a non-blocking toast notification (like `react-hot-toast` or a custom modal) for a better user experience. However, `alert()` is functional and won't cause the 500 error.

3.  **Unused Variables**:
    - Ensure you don't have unused variables like `response` if you aren't using them, but in the current code, `response` is used to get the ID for the pass, so it is necessary.

## Summary of Fix
1.  **Apply the Java code change** above to `VisitorController.java`.
2.  **Restart your Backend Server**.
3.  **Clear Browser Cache** (optional, but good practice) and try registering again.
